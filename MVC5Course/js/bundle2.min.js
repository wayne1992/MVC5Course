/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.4.5
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 * 
 */
(function(n){var t={init:function(i){return this.each(function(){var r=this,f=n(r).empty(),u,e,o;for(r.opt=n.extend(!0,{},n.fn.raty.defaults,i),f.data("settings",r.opt),r.opt.number=t.between(r.opt.number,0,20),r.opt.path.substring(r.opt.path.length-1,r.opt.path.length)!="/"&&(r.opt.path+="/"),typeof r.opt.score=="function"&&(r.opt.score=r.opt.score.call(r)),r.opt.score&&(r.opt.score=t.between(r.opt.score,0,r.opt.number)),u=1;u<=r.opt.number;u++)n("<img />",{src:r.opt.path+(!r.opt.score||r.opt.score<u?r.opt.starOff:r.opt.starOn),alt:u,title:u<=r.opt.hints.length&&r.opt.hints[u-1]!==null?r.opt.hints[u-1]:u}).appendTo(r),r.opt.space&&f.append(u<r.opt.number?"&#160;":"");r.stars=f.children('img:not(".raty-cancel")');r.score=n("<input />",{type:"hidden",name:r.opt.scoreName}).appendTo(r);r.opt.score&&r.opt.score>0&&(r.score.val(r.opt.score),t.roundStar.call(r,r.opt.score));r.opt.iconRange&&t.fill.call(r,r.opt.score);t.setTarget.call(r,r.opt.score,r.opt.targetKeep);e=r.opt.space?4:0;o=r.opt.width||r.opt.number*r.opt.size+r.opt.number*e;r.opt.cancel&&(r.cancel=n("<img />",{src:r.opt.path+r.opt.cancelOff,alt:"x",title:r.opt.cancelHint,"class":"raty-cancel"}),r.opt.cancelPlace=="left"?f.prepend("&#160;").prepend(r.cancel):f.append("&#160;").append(r.cancel),o+=r.opt.size+e);r.opt.readOnly?(t.fixHint.call(r),r.cancel&&r.cancel.hide()):(f.css("cursor","pointer"),t.bindAction.call(r));f.css("width",o)})},between:function(n,t,i){return Math.min(Math.max(parseFloat(n),t),i)},bindAction:function(){var i=this,r=n(i),u;r.mouseleave(function(){var n=i.score.val()||undefined;t.initialize.call(i,n);t.setTarget.call(i,n,i.opt.targetKeep);i.opt.mouseover&&i.opt.mouseover.call(i,n)});u=i.opt.half?"mousemove":"mouseover";i.opt.cancel&&i.cancel.mouseenter(function(){n(this).attr("src",i.opt.path+i.opt.cancelOn);i.stars.attr("src",i.opt.path+i.opt.starOff);t.setTarget.call(i,null,!0);i.opt.mouseover&&i.opt.mouseover.call(i,null)}).mouseleave(function(){n(this).attr("src",i.opt.path+i.opt.cancelOff);i.opt.mouseover&&i.opt.mouseover.call(i,i.score.val()||null)}).click(function(n){i.score.removeAttr("value");i.opt.click&&i.opt.click.call(i,null,n)});i.stars.bind(u,function(u){var f=parseInt(this.alt,10),e,o;i.opt.half?(e=parseFloat((u.pageX-n(this).offset().left)/i.opt.size),o=e>.5?1:.5,f=parseFloat(this.alt)-1+o,t.fill.call(i,f),i.opt.precision&&(f=f-o+e),t.showHalf.call(i,f)):t.fill.call(i,f);r.data("score",f);t.setTarget.call(i,f,!0);i.opt.mouseover&&i.opt.mouseover.call(i,f,u)}).click(function(n){i.score.val(i.opt.half||i.opt.precision?r.data("score"):this.alt);i.opt.click&&i.opt.click.call(i,i.score.val(),n)})},cancel:function(i){return n(this).each(function(){var r=this,u=n(r);if(u.data("readonly")===!0)return this;i?t.click.call(r,null):t.score.call(r,null);r.score.removeAttr("value")})},click:function(i){return n(this).each(function(){if(n(this).data("readonly")===!0)return this;t.initialize.call(this,i);this.opt.click?this.opt.click.call(this,i):t.error.call(this,'you must add the "click: function(score, evt) { }" callback.');t.setTarget.call(this,i,!0)})},error:function(t){n(this).html(t);n.error(t)},fill:function(n){for(var t=this,o=t.stars.length,f=0,e,r,u,i=1;i<=o;i++)e=t.stars.eq(i-1),t.opt.iconRange&&t.opt.iconRange.length>f?(r=t.opt.iconRange[f],u=t.opt.single?i==n?r.on||t.opt.starOn:r.off||t.opt.starOff:i<=n?r.on||t.opt.starOn:r.off||t.opt.starOff,i<=r.range&&e.attr("src",t.opt.path+u),i==r.range&&f++):(u=t.opt.single?i==n?t.opt.starOn:t.opt.starOff:i<=n?t.opt.starOn:t.opt.starOff,e.attr("src",t.opt.path+u))},fixHint:function(){var r=n(this),t=parseInt(this.score.val(),10),i=this.opt.noRatedMsg;!isNaN(t)&&t>0&&(i=t<=this.opt.hints.length&&this.opt.hints[t-1]!==null?this.opt.hints[t-1]:t);r.data("readonly",!0).css("cursor","default").attr("title",i);this.score.attr("readonly","readonly");this.stars.attr("title",i)},getScore:function(){var t=[],i;return n(this).each(function(){i=this.score.val();t.push(i?parseFloat(i):undefined)}),t.length>1?t:t[0]},readOnly:function(i){return this.each(function(){var r=n(this);if(r.data("readonly")===i)return this;this.cancel&&(i?this.cancel.hide():this.cancel.show());i?(r.unbind(),r.children("img").unbind(),t.fixHint.call(this)):(t.bindAction.call(this),t.unfixHint.call(this));r.data("readonly",i)})},reload:function(){return t.set.call(this,{})},roundStar:function(n){var i=(n-Math.floor(n)).toFixed(2),t;i>this.opt.round.down&&(t=this.opt.starOn,i<this.opt.round.up&&this.opt.halfShow?t=this.opt.starHalf:i<this.opt.round.full&&(t=this.opt.starOff),this.stars.eq(Math.ceil(n)-1).attr("src",this.opt.path+t))},score:function(){return arguments.length?t.setScore.apply(this,arguments):t.getScore.call(this)},set:function(t){return this.each(function(){var i=n(this),r=i.data("settings"),u=i.clone().removeAttr("style").insertBefore(i);i.remove();u.raty(n.extend(r,t))}),n(this.selector)},setScore:function(i){return n(this).each(function(){if(n(this).data("readonly")===!0)return this;t.initialize.call(this,i);t.setTarget.call(this,i,!0)})},setTarget:function(i,r){var f,u;this.opt.target&&(f=n(this.opt.target),f.length==0&&t.error.call(this,"target selector invalid or missing!"),u=i,u=r&&u!==undefined?this.opt.targetType=="hint"?u===null&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(u-1)]:this.opt.precision?parseFloat(u).toFixed(1):parseInt(u,10):this.opt.targetText,this.opt.targetFormat.indexOf("{score}")<0&&t.error.call(this,'template "{score}" missing!'),i!==null&&(u=this.opt.targetFormat.toString().replace("{score}",u)),f.is(":input")?f.val(u):f.html(u))},showHalf:function(n){var t=(n-Math.floor(n)).toFixed(1);t>0&&t<.6&&this.stars.eq(Math.ceil(n)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(n){n=n?t.between(n,0,this.opt.number):0;t.fill.call(this,n);n>0&&(this.opt.halfShow&&t.roundStar.call(this,n),this.score.val(n))},unfixHint:function(){for(var t=0;t<this.opt.number;t++)this.stars.eq(t).attr("title",t<this.opt.hints.length&&this.opt.hints[t]!==null?this.opt.hints[t]:t);n(this).data("readonly",!1).css("cursor","pointer").removeAttr("title");this.score.attr("readonly","readonly")}};n.fn.raty=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist!");else return t.init.apply(this,arguments)};n.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseover:undefined,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:undefined,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:undefined}})(jQuery);